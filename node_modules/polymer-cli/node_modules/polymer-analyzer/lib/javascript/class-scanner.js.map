{"version":3,"sources":["../src/javascript/class-scanner.ts"],"names":[],"mappings":"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","file":"class-scanner.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2015 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport generate from '@babel/generator';\nimport {NodePath} from '@babel/traverse';\nimport * as babel from '@babel/types';\nimport * as doctrine from 'doctrine';\n\nimport {Result} from '../model/analysis';\nimport {MapWithDefault, MethodParam, ScannedClass, ScannedFeature, ScannedMethod, ScannedProperty, ScannedReference, Severity, SourceRange, Warning} from '../model/model';\nimport {extractObservers} from '../polymer/declaration-property-handlers';\nimport {mergePropertyDeclarations, Observer, ScannedPolymerElement} from '../polymer/polymer-element';\nimport {ScannedPolymerElementMixin} from '../polymer/polymer-element-mixin';\nimport {getIsValue, getPolymerProperties, getStaticGetterValue} from '../polymer/polymer2-config';\nimport {MixinVisitor} from '../polymer/polymer2-mixin-scanner';\n\nimport * as astValue from './ast-value';\nimport {getIdentifierName, getNamespacedIdentifier} from './ast-value';\nimport {Visitor} from './estree-visitor';\nimport * as esutil from './esutil';\nimport {getClosureType, getConstructorClassMethod, getConstructorMethod, getMethods, getOrInferPrivacy, getReturnFromAnnotation, getStaticMethods, inferReturnFromBody, toMethodParam} from './esutil';\nimport {JavaScriptDocument} from './javascript-document';\nimport {JavaScriptScanner} from './javascript-scanner';\nimport * as jsdoc from './jsdoc';\n\n\n/**\n * Represents the first argument of a call to customElements.define.\n */\ntype TagNameExpression = ClassDotIsExpression|StringLiteralExpression;\n\n/** The tagname was the `is` property on an class, like `MyElem.is` */\ninterface ClassDotIsExpression {\n  type: 'is';\n  className: string;\n  classNameSourceRange: SourceRange;\n}\n/** The tag name was just a string literal. */\ninterface StringLiteralExpression {\n  type: 'string-literal';\n  value: string;\n  sourceRange: SourceRange;\n}\n\n\nexport interface ScannedAttribute extends ScannedFeature {\n  name: string;\n  type?: string;\n}\n\n/**\n * Find and classify classes from source code.\n *\n * Currently this has a bunch of Polymer stuff baked in that shouldn't be here\n * in order to support generating only one feature for stuff that's essentially\n * more specific kinds of classes, like Elements, PolymerElements, Mixins, etc.\n *\n * In a future change we'll add a mechanism whereby plugins can claim and\n * specialize classes.\n */\nexport class ClassScanner implements JavaScriptScanner {\n  async scan(\n      document: JavaScriptDocument,\n      visit: (visitor: Visitor) => Promise<void>) {\n    const classFinder = new ClassFinder(document);\n    const mixinFinder = new MixinVisitor(document);\n    const elementDefinitionFinder =\n        new CustomElementsDefineCallFinder(document);\n    const prototypeMemberFinder = new PrototypeMemberFinder(document);\n    // Find all classes and all calls to customElements.define()\n    await Promise.all([\n      visit(classFinder),\n      visit(elementDefinitionFinder),\n      visit(mixinFinder),\n      visit(prototypeMemberFinder),\n    ]);\n    const mixins = mixinFinder.mixins;\n\n    const elementDefinitionsByClassName = new Map<string, ElementDefineCall>();\n    // For classes that show up as expressions in the second argument position\n    // of a customElements.define call.\n    const elementDefinitionsByClassExpression =\n        new Map<babel.ClassExpression, ElementDefineCall>();\n\n    for (const defineCall of elementDefinitionFinder.calls) {\n      // MaybeChainedIdentifier is invented below. It's like Identifier, but it\n      // includes 'Polymer.Element' as a name.\n      if (defineCall.class_.type === 'MaybeChainedIdentifier') {\n        elementDefinitionsByClassName.set(defineCall.class_.name, defineCall);\n      } else {\n        elementDefinitionsByClassExpression.set(defineCall.class_, defineCall);\n      }\n    }\n    // TODO(rictic): emit ElementDefineCallFeatures for define calls that don't\n    //     map to any local classes?\n\n    const mixinClassExpressions = new Set<babel.Node>();\n    for (const mixin of mixins) {\n      if (mixin.classAstNode) {\n        mixinClassExpressions.add(mixin.classAstNode);\n      }\n    }\n\n    // Next we want to distinguish custom elements from other classes.\n    const customElements: CustomElementDefinition[] = [];\n    const normalClasses = [];\n    const classMap = new Map<string, ScannedClass>();\n\n    for (const class_ of classFinder.classes) {\n      if (class_.astNode.language === 'js' &&\n          mixinClassExpressions.has(class_.astNode.node)) {\n        // This class is a mixin and has already been handled as such.\n        continue;\n      }\n      if (class_.name) {\n        classMap.set(class_.name, class_);\n      }\n      // Class expressions inside the customElements.define call\n      if (babel.isClassExpression(class_.astNode.node)) {\n        const definition =\n            elementDefinitionsByClassExpression.get(class_.astNode.node);\n        if (definition) {\n          customElements.push({class_, definition});\n          continue;\n        }\n      }\n      // Classes whose names are referenced in a same-file customElements.define\n      const definition = elementDefinitionsByClassName.get(class_.name!) ||\n          elementDefinitionsByClassName.get(class_.localName!);\n      if (definition) {\n        customElements.push({class_, definition});\n        continue;\n      }\n      // Classes explicitly defined as elements in their jsdoc tags.\n      // TODO(justinfagnani): remove @polymerElement support\n      if (jsdoc.hasTag(class_.jsdoc, 'customElement') ||\n          jsdoc.hasTag(class_.jsdoc, 'polymerElement')) {\n        customElements.push({class_});\n        continue;\n      }\n      // Classes that aren't custom elements, or at least, aren't obviously.\n      normalClasses.push(class_);\n    }\n\n    for (const [name, members] of prototypeMemberFinder.members) {\n      if (classMap.has(name)) {\n        const cls = classMap.get(name)!;\n        cls.finishInitialization(members.methods, members.properties);\n      }\n    }\n\n    const scannedFeatures: (ScannedPolymerElement|ScannedClass|\n                            ScannedPolymerElementMixin)[] = [];\n    for (const element of customElements) {\n      scannedFeatures.push(this._makeElementFeature(element, document));\n    }\n    for (const scannedClass of normalClasses) {\n      scannedFeatures.push(scannedClass);\n    }\n    for (const mixin of mixins) {\n      scannedFeatures.push(mixin);\n    }\n\n    return {\n      features: scannedFeatures,\n      warnings: [\n        ...elementDefinitionFinder.warnings,\n        ...classFinder.warnings,\n        ...mixinFinder.warnings,\n      ]\n    };\n  }\n\n  private _makeElementFeature(\n      element: CustomElementDefinition,\n      document: JavaScriptDocument): ScannedPolymerElement {\n    const class_ = element.class_;\n    const astNode = element.class_.astNode;\n    const docs = element.class_.jsdoc;\n    const customElementTag = jsdoc.getTag(class_.jsdoc, 'customElement');\n    let tagName: string|undefined = undefined;\n    if (element.definition &&\n        element.definition.tagName.type === 'string-literal') {\n      tagName = element.definition.tagName.value;\n    } else if (customElementTag && customElementTag.description) {\n      tagName = customElementTag.description;\n    } else if (\n        babel.isClassExpression(astNode.node) ||\n        babel.isClassDeclaration(astNode.node)) {\n      tagName = getIsValue(astNode.node);\n    }\n    let warnings: Warning[] = [];\n\n    let scannedElement: ScannedPolymerElement;\n    let methods = new Map<string, ScannedMethod>();\n    let staticMethods = new Map<string, ScannedMethod>();\n    let observers: Observer[] = [];\n\n    // This will cover almost all classes, except those defined only by\n    // applying a mixin. e.g.   const MyElem = Mixin(HTMLElement)\n    if (babel.isClassExpression(astNode.node) ||\n        babel.isClassDeclaration(astNode.node)) {\n      const observersResult = this._getObservers(astNode.node, document);\n      observers = [];\n      if (observersResult) {\n        observers = observersResult.observers;\n        warnings = warnings.concat(observersResult.warnings);\n      }\n      const polymerProps = getPolymerProperties(astNode.node, document);\n      for (const prop of polymerProps) {\n        const constructorProp = class_.properties.get(prop.name);\n        let finalProp;\n        if (constructorProp) {\n          finalProp = mergePropertyDeclarations(constructorProp, prop);\n        } else {\n          finalProp = prop;\n        }\n        class_.properties.set(prop.name, finalProp);\n      }\n      methods = getMethods(astNode.node, document);\n      staticMethods = getStaticMethods(astNode.node, document);\n    }\n\n    const extendsTag = jsdoc.getTag(docs, 'extends');\n    const extends_ = extendsTag !== undefined ? extendsTag.name : undefined;\n    // TODO(justinfagnani): Infer mixin applications and superclass from AST.\n    scannedElement = new ScannedPolymerElement({\n      className: class_.name,\n      tagName,\n      astNode,\n      statementAst: class_.statementAst,\n      properties: [...class_.properties.values()],\n      methods,\n      staticMethods,\n      observers,\n      events: astNode.language === 'js' ?\n          esutil.getEventComments(astNode.node) :\n          new Map(),\n      attributes: new Map(),\n      behaviors: [],\n      extends: extends_,\n      listeners: [],\n\n      description: class_.description,\n      sourceRange: class_.sourceRange,\n      superClass: class_.superClass,\n      jsdoc: class_.jsdoc,\n      abstract: class_.abstract,\n      mixins: class_.mixins,\n      privacy: class_.privacy\n    });\n\n    if (babel.isClassExpression(astNode.node) ||\n        babel.isClassDeclaration(astNode.node)) {\n      const observedAttributes =\n          this._getObservedAttributes(astNode.node, document);\n\n      if (observedAttributes != null) {\n        // If a class defines observedAttributes, it overrides what the base\n        // classes defined.\n        // TODO(justinfagnani): define and handle composition patterns.\n        scannedElement.attributes.clear();\n        for (const attr of observedAttributes) {\n          scannedElement.attributes.set(attr.name, attr);\n        }\n      }\n    }\n\n    warnings.forEach((w) => scannedElement.warnings.push(w));\n\n    return scannedElement;\n  }\n\n  private _getObservers(\n      node: babel.ClassDeclaration|babel.ClassExpression,\n      document: JavaScriptDocument) {\n    const returnedValue = getStaticGetterValue(node, 'observers');\n    if (returnedValue) {\n      return extractObservers(returnedValue, document);\n    }\n  }\n\n  private _getObservedAttributes(\n      node: babel.ClassDeclaration|babel.ClassExpression,\n      document: JavaScriptDocument) {\n    const returnedValue = getStaticGetterValue(node, 'observedAttributes');\n    if (returnedValue && babel.isArrayExpression(returnedValue)) {\n      return this._extractAttributesFromObservedAttributes(\n          returnedValue, document);\n    }\n  }\n\n  /**\n   * Extract attributes from the array expression inside a static\n   * observedAttributes method.\n   *\n   * e.g.\n   *     static get observedAttributes() {\n   *       return [\n   *         /** @type {boolean} When given the element is totally inactive *\\/\n   *         'disabled',\n   *         /** @type {boolean} When given the element is expanded *\\/\n   *         'open'\n   *       ];\n   *     }\n   */\n  private _extractAttributesFromObservedAttributes(\n      arry: babel.ArrayExpression, document: JavaScriptDocument) {\n    const results: ScannedAttribute[] = [];\n    for (const expr of arry.elements) {\n      const value = astValue.expressionToValue(expr);\n      if (value && typeof value === 'string') {\n        let description = '';\n        let type: string|null = null;\n        const comment = esutil.getAttachedComment(expr);\n        if (comment) {\n          const annotation = jsdoc.parseJsdoc(comment);\n          description = annotation.description || description;\n          const tags = annotation.tags || [];\n          for (const tag of tags) {\n            if (tag.title === 'type') {\n              type = type || doctrine.type.stringify(tag.type!);\n            }\n            // TODO(justinfagnani): this appears wrong, any tag could have a\n            // description do we really let any tag's description override\n            // the previous?\n            description = description || tag.description || '';\n          }\n        }\n        const attribute: ScannedAttribute = {\n          name: value,\n          description: description,\n          sourceRange: document.sourceRangeForNode(expr),\n          astNode: {language: 'js', containingDocument: document, node: expr},\n          warnings: [],\n        };\n        if (type) {\n          attribute.type = type;\n        }\n        results.push(attribute);\n      }\n    }\n    return results;\n  }\n}\n\ninterface CustomElementDefinition {\n  class_: ScannedClass;\n  definition?: ElementDefineCall;\n}\n\nclass PrototypeMemberFinder implements Visitor {\n  readonly members = new MapWithDefault<string, {\n    methods: Map<string, ScannedMethod>,\n    properties: Map<string, ScannedProperty>\n  }>(() => ({\n       methods: new Map<string, ScannedMethod>(),\n       properties: new Map<string, ScannedProperty>()\n     }));\n  private readonly _document: JavaScriptDocument;\n\n  constructor(document: JavaScriptDocument) {\n    this._document = document;\n  }\n\n  enterExpressionStatement(node: babel.ExpressionStatement) {\n    if (babel.isAssignmentExpression(node.expression)) {\n      this._createMemberFromAssignment(\n          node.expression, getJSDocAnnotationForNode(node));\n    } else if (babel.isMemberExpression(node.expression)) {\n      this._createMemberFromMemberExpression(\n          node.expression, getJSDocAnnotationForNode(node));\n    }\n  }\n\n  private _createMemberFromAssignment(\n      node: babel.AssignmentExpression, jsdocAnn?: jsdoc.Annotation) {\n    if (!babel.isMemberExpression(node.left) ||\n        !babel.isMemberExpression(node.left.object) ||\n        !babel.isIdentifier(node.left.property)) {\n      return;\n    }\n\n    const leftExpr = node.left.object;\n    const leftProperty = node.left.property;\n    const cls = getIdentifierName(leftExpr.object);\n    if (!cls || getIdentifierName(leftExpr.property) !== 'prototype') {\n      return;\n    }\n\n    if (babel.isFunctionExpression(node.right)) {\n      const prop = this._createMethodFromExpression(\n          leftProperty.name, node.right, jsdocAnn);\n      if (prop) {\n        this._addMethodToClass(cls, prop);\n      }\n    } else {\n      const method =\n          this._createPropertyFromExpression(leftProperty.name, node, jsdocAnn);\n      if (method) {\n        this._addPropertyToClass(cls, method);\n      }\n    }\n  }\n\n  private _addMethodToClass(cls: string, member: ScannedMethod) {\n    const classMembers = this.members.get(cls);\n    classMembers.methods.set(member.name, member);\n  }\n\n  private _addPropertyToClass(cls: string, member: ScannedProperty) {\n    const classMembers = this.members.get(cls);\n    classMembers.properties.set(member.name, member);\n  }\n\n  private _createMemberFromMemberExpression(\n      node: babel.MemberExpression, jsdocAnn: jsdoc.Annotation|undefined) {\n    const left = node.object;\n\n    // we only want `something.prototype.member`\n    if (!babel.isIdentifier(node.property) || !babel.isMemberExpression(left) ||\n        getIdentifierName(left.property) !== 'prototype') {\n      return;\n    }\n\n    const cls = getIdentifierName(left.object);\n\n    if (!cls) {\n      return;\n    }\n\n    if (jsdoc.hasTag(jsdocAnn, 'function')) {\n      const prop =\n          this._createMethodFromExpression(node.property.name, node, jsdocAnn);\n      if (prop) {\n        this._addMethodToClass(cls, prop);\n      }\n    } else {\n      const method = this._createPropertyFromExpression(\n          node.property.name, node, jsdocAnn);\n      if (method) {\n        this._addPropertyToClass(cls, method);\n      }\n    }\n  }\n\n  private _createPropertyFromExpression(\n      name: string, node: babel.AssignmentExpression|babel.MemberExpression,\n      jsdocAnn: jsdoc.Annotation|undefined) {\n    let description;\n    let type;\n    let readOnly = false;\n    const privacy = getOrInferPrivacy(name, jsdocAnn);\n    const sourceRange = this._document.sourceRangeForNode(node)!;\n    const warnings: Warning[] = [];\n\n    if (jsdocAnn) {\n      description = jsdoc.getDescription(jsdocAnn);\n      readOnly = jsdoc.hasTag(jsdocAnn, 'readonly');\n    }\n\n    let detectedType: Result<string, Warning>;\n\n    if (babel.isAssignmentExpression(node)) {\n      detectedType =\n          getClosureType(node.right, jsdocAnn, sourceRange, this._document);\n    } else {\n      detectedType =\n          getClosureType(node, jsdocAnn, sourceRange, this._document);\n    }\n\n    if (detectedType.successful) {\n      type = detectedType.value;\n    } else {\n      warnings.push(detectedType.error);\n      type = '?';\n    }\n\n    return {\n      name,\n      astNode:\n          {language: 'js' as 'js', containingDocument: this._document, node},\n      type,\n      jsdoc: jsdocAnn,\n      sourceRange,\n      description,\n      privacy,\n      warnings,\n      readOnly,\n    };\n  }\n\n  private _createMethodFromExpression(\n      name: string, node: babel.FunctionExpression|babel.MemberExpression,\n      jsdocAnn: jsdoc.Annotation|undefined) {\n    let description;\n    let ret;\n    const privacy = getOrInferPrivacy(name, jsdocAnn);\n    const params = new Map<string, MethodParam>();\n\n    if (jsdocAnn) {\n      description = jsdoc.getDescription(jsdocAnn);\n      ret = getReturnFromAnnotation(jsdocAnn);\n\n      if (babel.isFunctionExpression(node)) {\n        (node.params || []).forEach((nodeParam) => {\n          const param = toMethodParam(nodeParam, jsdocAnn);\n          params.set(param.name, param);\n        });\n      } else {\n        for (const tag of (jsdocAnn.tags || [])) {\n          if (tag.title !== 'param' || !tag.name) {\n            continue;\n          }\n          let tagType;\n          let tagDescription;\n          if (tag.type) {\n            tagType = doctrine.type.stringify(tag.type);\n          }\n          if (tag.description) {\n            tagDescription = tag.description;\n          }\n          params.set(\n              tag.name,\n              {name: tag.name, type: tagType, description: tagDescription});\n        }\n      }\n    }\n\n    if (ret === undefined && babel.isFunctionExpression(node)) {\n      ret = inferReturnFromBody(node);\n    }\n\n    return {\n      name,\n      type: ret !== undefined ? ret.type : undefined,\n      description,\n      sourceRange: this._document.sourceRangeForNode(node)!,\n      warnings: [],\n      astNode:\n          {language: 'js' as 'js', containingDocument: this._document, node},\n      jsdoc: jsdocAnn,\n      params: Array.from(params.values()),\n      return: ret,\n      privacy\n    };\n  }\n}\n\n/**\n * Finds all classes and matches them up with their best jsdoc comment.\n */\nclass ClassFinder implements Visitor {\n  readonly classes: ScannedClass[] = [];\n  readonly warnings: Warning[] = [];\n  private readonly alreadyMatched = new Set<babel.ClassExpression>();\n  private readonly _document: JavaScriptDocument;\n\n  constructor(document: JavaScriptDocument) {\n    this._document = document;\n  }\n\n  enterAssignmentExpression(\n      node: babel.AssignmentExpression, _parent: babel.Node, path: NodePath) {\n    this.handleGeneralAssignment(\n        astValue.getIdentifierName(node.left), node.right, path);\n  }\n\n  enterVariableDeclarator(\n      node: babel.VariableDeclarator, _parent: babel.Node, path: NodePath) {\n    if (node.init) {\n      this.handleGeneralAssignment(\n          astValue.getIdentifierName(node.id), node.init, path);\n    }\n  }\n\n  /** Generalizes over variable declarators and assignment expressions. */\n  private handleGeneralAssignment(\n      assignedName: string|undefined, value: babel.Expression, path: NodePath) {\n    const doc = jsdoc.parseJsdoc(esutil.getBestComment(path) || '');\n    if (babel.isClassExpression(value)) {\n      const name = assignedName ||\n          value.id && astValue.getIdentifierName(value.id) || undefined;\n\n      this._classFound(name, doc, value, path);\n    } else {\n      // TODO(justinfagnani): remove @polymerElement support\n      if (jsdoc.hasTag(doc, 'customElement') ||\n          jsdoc.hasTag(doc, 'polymerElement')) {\n        this._classFound(assignedName, doc, value, path);\n      }\n    }\n  }\n\n  enterClassExpression(\n      node: babel.ClassExpression, parent: babel.Node, path: NodePath) {\n    // Class expressions may be on the right hand side of assignments, so\n    // we may have already handled this expression from the parent or\n    // grandparent node. Class declarations can't be on the right hand side of\n    // assignments, so they'll definitely only be handled once.\n    if (this.alreadyMatched.has(node)) {\n      return;\n    }\n\n    const name = node.id ? astValue.getIdentifierName(node.id) : undefined;\n    const comment = esutil.getAttachedComment(node) ||\n        esutil.getAttachedComment(parent) || '';\n    this._classFound(name, jsdoc.parseJsdoc(comment), node, path);\n  }\n\n  enterClassDeclaration(\n      node: babel.ClassDeclaration, parent: babel.Node, path: NodePath) {\n    const name = astValue.getIdentifierName(node.id);\n    const comment = esutil.getAttachedComment(node) ||\n        esutil.getAttachedComment(parent) || '';\n    this._classFound(name, jsdoc.parseJsdoc(comment), node, path);\n  }\n\n  private _classFound(\n      name: string|undefined, doc: jsdoc.Annotation, astNode: babel.Node,\n      path: NodePath) {\n    const namespacedName = name && getNamespacedIdentifier(name, doc);\n\n    const warnings: Warning[] = [];\n    const properties = extractPropertiesFromClass(astNode, this._document);\n    const methods = getMethods(astNode, this._document);\n    const constructorMethod = getConstructorMethod(astNode, this._document);\n\n    this.classes.push(new ScannedClass(\n        namespacedName,\n        name,\n        {language: 'js', containingDocument: this._document, node: astNode},\n        esutil.getCanonicalStatement(path),\n        doc,\n        (doc.description || '').trim(),\n        this._document.sourceRangeForNode(astNode)!,\n        properties,\n        methods,\n        constructorMethod,\n        getStaticMethods(astNode, this._document),\n        this._getExtends(astNode, doc, warnings, this._document, path),\n        jsdoc.getMixinApplications(\n            this._document, astNode, doc, warnings, path),\n        getOrInferPrivacy(namespacedName || '', doc),\n        warnings,\n        jsdoc.hasTag(doc, 'abstract'),\n        jsdoc.extractDemos(doc)));\n    if (babel.isClassExpression(astNode)) {\n      this.alreadyMatched.add(astNode);\n    }\n  }\n\n  /**\n   * Returns the name of the superclass, if any.\n   */\n  private _getExtends(\n      node: babel.Node, docs: jsdoc.Annotation, warnings: Warning[],\n      document: JavaScriptDocument,\n      path: NodePath): ScannedReference<'class'>|undefined {\n    const extendsAnnotations =\n        docs.tags!.filter((tag) => tag.title === 'extends');\n\n    // prefer @extends annotations over extends clauses\n    if (extendsAnnotations.length > 0) {\n      const extendsId = extendsAnnotations[0].name;\n      // TODO(justinfagnani): we need source ranges for jsdoc annotations\n      const sourceRange = document.sourceRangeForNode(node)!;\n      if (extendsId == null) {\n        warnings.push(new Warning({\n          code: 'class-extends-annotation-no-id',\n          message: '@extends annotation with no identifier',\n          severity: Severity.WARNING,\n          sourceRange,\n          parsedDocument: this._document\n        }));\n      } else {\n        return new ScannedReference(\n            'class', extendsId, sourceRange, undefined, path);\n      }\n    } else if (\n        babel.isClassDeclaration(node) || babel.isClassExpression(node)) {\n      // If no @extends tag, look for a superclass.\n      const superClass = node.superClass;\n      if (superClass != null) {\n        let extendsId = getIdentifierName(superClass);\n        if (extendsId != null) {\n          if (extendsId.startsWith('window.')) {\n            extendsId = extendsId.substring('window.'.length);\n          }\n          const sourceRange = document.sourceRangeForNode(superClass)!;\n          return new ScannedReference(\n              'class',\n              extendsId,\n              sourceRange,\n              {\n                language: 'js',\n                node: node.superClass,\n                containingDocument: document\n              },\n              path);\n        }\n      }\n    }\n  }\n}\n\ninterface ElementDefineCall {\n  tagName: TagNameExpression;\n  class_: ElementClassExpression;\n}\n\ntype ElementClassExpression = babel.ClassExpression|{\n  type: 'MaybeChainedIdentifier';\n  name: string, sourceRange: SourceRange\n};\n\n/** Finds calls to customElements.define() */\nclass CustomElementsDefineCallFinder implements Visitor {\n  readonly warnings: Warning[] = [];\n  readonly calls: ElementDefineCall[] = [];\n  private readonly _document: JavaScriptDocument;\n\n  constructor(document: JavaScriptDocument) {\n    this._document = document;\n  }\n\n  enterCallExpression(node: babel.CallExpression) {\n    const callee = astValue.getIdentifierName(node.callee);\n    if (!(callee === 'window.customElements.define' ||\n          callee === 'customElements.define')) {\n      return;\n    }\n\n    const tagNameExpression = this._getTagNameExpression(node.arguments[0]);\n    if (tagNameExpression == null) {\n      return;\n    }\n    const elementClassExpression =\n        this._getElementClassExpression(node.arguments[1]);\n    if (elementClassExpression == null) {\n      return;\n    }\n    this.calls.push(\n        {tagName: tagNameExpression, class_: elementClassExpression});\n  }\n\n  private _getTagNameExpression(expression: babel.Node|\n                                undefined): TagNameExpression|undefined {\n    if (expression == null) {\n      return;\n    }\n    const tryForLiteralString = astValue.expressionToValue(expression);\n    if (tryForLiteralString != null &&\n        typeof tryForLiteralString === 'string') {\n      return {\n        type: 'string-literal',\n        value: tryForLiteralString,\n        sourceRange: this._document.sourceRangeForNode(expression)!\n      };\n    }\n    if (babel.isMemberExpression(expression)) {\n      // Might be something like MyElement.is\n      const isPropertyNameIs = (babel.isIdentifier(expression.property) &&\n                                expression.property.name === 'is') ||\n          (astValue.expressionToValue(expression.property) === 'is');\n      const className = astValue.getIdentifierName(expression.object);\n      if (isPropertyNameIs && className) {\n        return {\n          type: 'is',\n          className,\n          classNameSourceRange:\n              this._document.sourceRangeForNode(expression.object)!\n        };\n      }\n    }\n    this.warnings.push(new Warning({\n      code: 'cant-determine-element-tagname',\n      message:\n          `Unable to evaluate this expression down to a definitive string ` +\n          `tagname.`,\n      severity: Severity.WARNING,\n      sourceRange: this._document.sourceRangeForNode(expression)!,\n      parsedDocument: this._document\n    }));\n    return undefined;\n  }\n\n  private _getElementClassExpression(elementDefn: babel.Node|\n                                     undefined): ElementClassExpression|null {\n    if (elementDefn == null) {\n      return null;\n    }\n    const className = astValue.getIdentifierName(elementDefn);\n    if (className) {\n      return {\n        type: 'MaybeChainedIdentifier',\n        name: className,\n        sourceRange: this._document.sourceRangeForNode(elementDefn)!\n      };\n    }\n    if (babel.isClassExpression(elementDefn)) {\n      return elementDefn;\n    }\n    this.warnings.push(new Warning({\n      code: 'cant-determine-element-class',\n      message: `Unable to evaluate this expression down to a class reference.`,\n      severity: Severity.WARNING,\n      sourceRange: this._document.sourceRangeForNode(elementDefn)!,\n      parsedDocument: this._document,\n    }));\n    return null;\n  }\n}\n\nexport function extractPropertiesFromClass(\n    astNode: babel.Node, document: JavaScriptDocument) {\n  const properties = new Map<string, ScannedProperty>();\n\n  if (!babel.isClass(astNode)) {\n    return properties;\n  }\n\n  const construct = getConstructorClassMethod(astNode);\n\n  if (construct) {\n    const props = extractPropertiesFromConstructor(construct, document);\n    for (const prop of props.values()) {\n      properties.set(prop.name, prop);\n    }\n  }\n\n  for (const prop of esutil\n           .extractPropertiesFromClassOrObjectBody(astNode, document)\n           .values()) {\n    properties.set(prop.name, prop);\n  }\n\n  return properties;\n}\n\nfunction extractPropertyFromExpressionStatement(\n    statement: babel.ExpressionStatement,\n    document: JavaScriptDocument): ScannedProperty|null {\n  let name;\n  let astNode;\n  let defaultValue;\n\n  if (babel.isAssignmentExpression(statement.expression)) {\n    // statements like:\n    // /** @public The foo. */\n    // this.foo = baz;\n    name = getPropertyNameOnThisExpression(statement.expression.left);\n    astNode = statement.expression.left;\n    defaultValue = generate(statement.expression.right).code;\n  } else if (babel.isMemberExpression(statement.expression)) {\n    // statements like:\n    // /** @public The foo. */\n    // this.foo;\n    name = getPropertyNameOnThisExpression(statement.expression);\n    astNode = statement;\n  } else {\n    return null;\n  }\n\n  if (name === undefined) {\n    return null;\n  }\n\n  const annotation = getJSDocAnnotationForNode(statement);\n  if (!annotation) {\n    return null;\n  }\n\n  return {\n    name,\n    astNode:\n        {language: 'js' as 'js', containingDocument: document, node: astNode},\n    type: getTypeFromAnnotation(annotation),\n    default: defaultValue,\n    jsdoc: annotation,\n    sourceRange: document.sourceRangeForNode(astNode)!,\n    description: jsdoc.getDescription(annotation),\n    privacy: getOrInferPrivacy(name, annotation),\n    warnings: [],\n    readOnly: jsdoc.hasTag(annotation, 'const'),\n  };\n}\n\nfunction extractPropertiesFromConstructor(\n    method: babel.ClassMethod, document: JavaScriptDocument) {\n  const properties = new Map<string, ScannedProperty>();\n\n  for (const statement of method.body.body) {\n    if (!babel.isExpressionStatement(statement)) {\n      continue;\n    }\n    const prop = extractPropertyFromExpressionStatement(statement, document);\n    if (!prop) {\n      continue;\n    }\n    properties.set(prop.name, prop);\n  }\n\n  return properties;\n}\n\nfunction getJSDocAnnotationForNode(node: babel.Node) {\n  const comment = esutil.getAttachedComment(node);\n  const jsdocAnn =\n      comment === undefined ? undefined : jsdoc.parseJsdoc(comment);\n\n  if (!jsdocAnn || jsdocAnn.tags.length === 0) {\n    // The comment only counts if there's a jsdoc annotation in there\n    // somewhere.\n    // Otherwise it's just an assignment, maybe to a property in a\n    // super class or something.\n    return undefined;\n  }\n\n  return jsdocAnn;\n}\n\nfunction getTypeFromAnnotation(jsdocAnn: jsdoc.Annotation): string|undefined {\n  const typeTag = jsdoc.getTag(jsdocAnn, 'type');\n  let type = undefined;\n\n  if (typeTag && typeTag.type) {\n    type = doctrine.type.stringify(typeTag.type);\n  }\n\n  return type;\n}\n\nfunction getPropertyNameOnThisExpression(node: babel.Node) {\n  if (!babel.isMemberExpression(node) || node.computed ||\n      !babel.isThisExpression(node.object) ||\n      !babel.isIdentifier(node.property)) {\n    return;\n  }\n  return node.property.name;\n}\n"]}