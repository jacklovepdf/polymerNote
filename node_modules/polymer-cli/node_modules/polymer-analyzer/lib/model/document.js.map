{"version":3,"sources":["../src/model/document.ts"],"names":[],"mappings":"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","file":"document.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2016 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as babel from '@babel/types';\n\nimport {AnalysisContext} from '../core/analysis-context';\nimport {ParsedCssDocument} from '../css/css-document';\nimport {ParsedHtmlDocument} from '../html/html-document';\nimport {JavaScriptDocument} from '../javascript/javascript-document';\nimport {ParsedJsonDocument} from '../json/json-document';\nimport {ParsedDocument} from '../parser/document';\nimport {ParsedTypeScriptDocument} from '../typescript/typescript-document';\n\nimport {Analysis} from './analysis';\nimport {DocumentBackreference} from './document-backreference';\nimport {Feature, ScannedFeature} from './feature';\nimport {ImmutableSet, unsafeAsMutable} from './immutable';\nimport {Import} from './import';\nimport {AstNodeWithLanguage, ScannedInlineDocument} from './inline-document';\nimport {MapWithDefault} from './map';\nimport {DocumentQuery as Query, DocumentQueryWithKind as QueryWithKind, FeatureKind, FeatureKindMap, Queryable} from './queryable';\nimport {isResolvable} from './resolvable';\nimport {SourceRange} from './source-range';\nimport {ResolvedUrl} from './url';\nimport {Warning} from './warning';\n\n/**\n * The metadata for all features and elements defined in one document\n */\nexport class ScannedDocument {\n  document: ParsedDocument;\n  features: ScannedFeature[];\n  warnings: Warning[];\n  isInline = false;\n\n  get sourceRange() {\n    return this.document.sourceRange;\n  }\n  get astNode(): AstNodeWithLanguage|undefined {\n    return this.document.astNode;\n  }\n\n  constructor(\n      document: ParsedDocument, features: ScannedFeature[],\n      warnings: Warning[] = []) {\n    this.document = document;\n    this.features = features;\n    this.warnings = warnings;\n    this.isInline = document.isInline;\n  }\n\n  get url() {\n    return this.document.url;\n  }\n\n  /**\n   * Gets all features in this scanned document and all inline documents it\n   * contains.\n   */\n  getNestedFeatures(): ScannedFeature[] {\n    const result: ScannedFeature[] = [];\n    this._getNestedFeatures(result);\n    return result;\n  }\n\n  private _getNestedFeatures(features: ScannedFeature[]): void {\n    for (const feature of this.features) {\n      // Ad hoc test needed here to avoid a problematic import loop.\n      const maybeInlineDoc = feature as Partial<ScannedInlineDocument>;\n      if (maybeInlineDoc.constructor.name === 'ScannedInlineDocument' &&\n          maybeInlineDoc.scannedDocument) {\n        maybeInlineDoc.scannedDocument._getNestedFeatures(features);\n      } else {\n        features.push(feature);\n      }\n    }\n  }\n}\nexport interface DeclaredWithStatement {\n  /**\n   * This is the nearest statement at or above `this.astNode`.\n   *\n   * This is a fast and simple way to get a canonical, indexable AST node,\n   * so that we can look up a feature syntactically.\n   *\n   * Populate this field with `esutil.getCanonicalStatement`.\n   */\n  statementAst: babel.Statement|undefined;\n}\nfunction isDeclaredWithStatement(\n    feature: Feature&Partial<DeclaredWithStatement>): feature is Feature&\n    DeclaredWithStatement {\n  return feature.statementAst !== undefined;\n}\n\ndeclare module './queryable' {\n  interface FeatureKindMap {\n    'document': Document;\n\n    // Document specializations.\n    'html-document': Document<ParsedHtmlDocument>;\n    'js-document': Document<JavaScriptDocument>;\n    'json-document': Document<ParsedJsonDocument>;\n    'css-document': Document<ParsedCssDocument>;\n    'typescript-document': Document<ParsedTypeScriptDocument>;\n  }\n}\nexport class Document<ParsedType extends ParsedDocument = ParsedDocument>\n    implements Feature, Queryable {\n  readonly kinds: ImmutableSet<string> = new Set(['document']);\n  readonly identifiers: ImmutableSet<string> = new Set();\n\n  /**\n   * AnalysisContext is a private type. Only internal analyzer code should touch\n   * this field.\n   */\n  _analysisContext: AnalysisContext;\n  warnings: Warning[];\n  languageAnalysis?: {};\n\n  private readonly _localFeatures = new Set<Feature>();\n  private readonly _scannedDocument: ScannedDocument;\n  private readonly _localFeaturesByStatement =\n      new MapWithDefault<babel.Statement, Set<Feature>>(() => new Set());\n\n\n  /**\n   * To handle recursive dependency graphs we must track whether we've started\n   * resolving this Document so that we can reliably early exit even if one\n   * of our dependencies tries to resolve this document.\n   */\n  private _begunResolving = false;\n\n  /**\n   * True after this document and all of its children are finished resolving.\n   */\n  private _doneResolving = false;\n\n  constructor(\n      base: ScannedDocument, analyzer: AnalysisContext, languageAnalysis?: {}) {\n    if (base == null) {\n      throw new Error('base is null');\n    }\n    if (analyzer == null) {\n      throw new Error('analyzer is null');\n    }\n    this._scannedDocument = base;\n    this._analysisContext = analyzer;\n    this.languageAnalysis = languageAnalysis;\n\n    if (!base.isInline) {\n      unsafeAsMutable(this.identifiers).add(this.url);\n    }\n    unsafeAsMutable(this.kinds).add(`${this.parsedDocument.type}-document`);\n    this.warnings = Array.from(base.warnings);\n  }\n\n  get url(): ResolvedUrl {\n    return this._scannedDocument.url;\n  }\n\n  get isInline(): boolean {\n    return this._scannedDocument.isInline;\n  }\n\n  get sourceRange(): SourceRange|undefined {\n    return this._scannedDocument.sourceRange;\n  }\n\n  get astNode(): AstNodeWithLanguage|undefined {\n    return this._scannedDocument.astNode;\n  }\n\n  get parsedDocument(): ParsedType {\n    return this._scannedDocument.document as ParsedType;\n  }\n\n  get resolved(): boolean {\n    return this._doneResolving;\n  }\n\n  get type(): string {\n    return this.parsedDocument.type;\n  }\n\n  /**\n   * Resolves all features of this document, so that they have references to all\n   * their dependencies.\n   *\n   * This method can only be called once\n   */\n  // TODO(justinfagnani): move to ScannedDocument\n  resolve() {\n    if (this._doneResolving) {\n      throw new Error('resolve can only be called once');\n    }\n    if (this._begunResolving) {\n      return;\n    }\n    this._begunResolving = true;\n    this._addFeature(this);\n    for (const scannedFeature of this._scannedDocument.features) {\n      if (isResolvable(scannedFeature)) {\n        const feature = scannedFeature.resolve(this);\n        if (feature) {\n          this._addFeature(feature);\n        }\n      }\n    }\n    this._doneResolving = true;\n  }\n\n  /**\n   * Adds and indexes a feature to this document before resolve().\n   */\n  _addFeature(feature: Feature) {\n    if (this._doneResolving) {\n      throw new Error('_addFeature can not be called after _resolve()');\n    }\n    this._indexFeature(feature);\n    this._localFeatures.add(feature);\n\n    if (isDeclaredWithStatement(feature) &&\n        feature.statementAst !== undefined) {\n      this._localFeaturesByStatement.get(feature.statementAst).add(feature);\n    }\n  }\n\n  /**\n   * Get features on the document.\n   *\n   * Be default it includes only features on the document, but you can specify\n   * whether to include features that are reachable by imports, features from\n   * outside the current package, etc. See the documentation for Query for more\n   * details.\n   *\n   * You can also narrow by feature kind and identifier.\n   */\n  getFeatures<K extends FeatureKind>(query: QueryWithKind<K>):\n      Set<FeatureKindMap[K]>;\n  getFeatures(query?: Query): Set<Feature>;\n  getFeatures(query: Query = {}): Set<Feature> {\n    if (query.statement !== undefined) {\n      return this._getByStatement(query.statement, query.kind);\n    }\n    if (query.id && query.kind) {\n      return this._getById(query.kind, query.id, query);\n    } else if (query.kind) {\n      return this._getByKind(query.kind, query);\n    }\n    const features = new Set();\n    this._listFeatures(features, new Set(), query);\n    const queryId = query.id;\n    if (queryId) {\n      const filteredFeatures =\n          Array.from(features).filter((f) => f.identifiers.has(queryId));\n      return new Set(filteredFeatures);\n    }\n    return features;\n  }\n\n  private _getByKind<K extends FeatureKind>(kind: K, query?: Query):\n      Set<FeatureKindMap[K]>;\n  private _getByKind(kind: string, query?: Query): Set<Feature>;\n  private _getByKind(kind: string, query: Query = {}): Set<Feature> {\n    if (this._featuresByKind && this._isCachable(query)) {\n      // We have a fast index! Use that.\n      const features = this._featuresByKind.get(kind) || new Set();\n      if (!query.externalPackages) {\n        return this._filterOutExternal(features);\n      }\n      return features;\n    } else if (this._doneResolving && this._isCachable(query)) {\n      // We're done discovering features in this document and its children so\n      // we can safely build up the indexes.\n      this._buildIndexes();\n      return this._getByKind(kind, query);\n    }\n    return this._getSlowlyByKind(kind, query);\n  }\n\n  private _getById<K extends FeatureKind>(\n      kind: K, identifier: string, query?: Query): Set<FeatureKindMap[K]>;\n  private _getById(kind: string, identifier: string, query?: Query):\n      Set<Feature>;\n  private _getById(kind: string, identifier: string, query: Query = {}):\n      Set<Feature> {\n    if (this._featuresByKindAndId && this._isCachable(query)) {\n      // We have a fast index! Use that.\n      const idMap = this._featuresByKindAndId.get(kind);\n      const features = (idMap && idMap.get(identifier)) || new Set();\n      if (!query.externalPackages) {\n        return this._filterOutExternal(features);\n      }\n      return features;\n    } else if (this._doneResolving && this._isCachable(query)) {\n      // We're done discovering features in this document and its children so\n      // we can safely build up the indexes.\n      this._buildIndexes();\n      return this._getById(kind, identifier, query);\n    }\n    const result = new Set<Feature>();\n    for (const featureOfKind of this._getByKind(kind, query)) {\n      if (featureOfKind.identifiers.has(identifier)) {\n        result.add(featureOfKind);\n      }\n    }\n    return result;\n  }\n\n  private _getByStatement(statement: babel.Statement, kind: string|undefined) {\n    const result = this._localFeaturesByStatement.get(statement);\n    if (kind === undefined) {\n      return result;\n    }\n    return this._filterByKind(result, kind);\n  }\n\n  /** Filters out the given features by the given kind. */\n  private _filterByKind(features: Iterable<Feature>, kind: string) {\n    const result = new Set<Feature>();\n    for (const feature of features) {\n      if (feature.kinds.has(kind)) {\n        result.add(feature);\n      }\n    }\n    return result;\n  }\n\n  private _isCachable(query: Query = {}): boolean {\n    return !!query.imported && !query.noLazyImports &&\n        !query.excludeBackreferences;\n  }\n\n  private _getSlowlyByKind(kind: string, query: Query): Set<Feature> {\n    const allFeatures = new Set<Feature>();\n    this._listFeatures(allFeatures, new Set(), query);\n\n    const result = new Set<Feature>();\n    for (const feature of allFeatures) {\n      if (feature.kinds.has(kind)) {\n        result.add(feature);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * Walks the graph of documents, starting from `this`, finding features which\n   * match the given query and adding them to the `result` set. Uses `visited`\n   * to deal with cycles.\n   *\n   * This method is O(numFeatures), though it does not walk documents that are\n   * not relevant to the query (e.g. based on whether the query follows imports,\n   * or excludes lazy imports)\n   */\n  private _listFeatures(\n      result: Set<Feature>, visited: Set<Document>, query: Query) {\n    if (visited.has(this)) {\n      return;\n    }\n    visited.add(this);\n    for (const feature of this._localFeatures) {\n      // Don't include a DocumentBackreference feature in the result set if the\n      // query excludes them.\n      if (!feature.kinds.has('document-backreference') ||\n          !query.excludeBackreferences) {\n        result.add(feature);\n      }\n      if (feature.kinds.has('document-backreference') &&\n          !query.excludeBackreferences) {\n        const containerDocument = (feature as DocumentBackreference).document;\n        result.add(containerDocument);\n        containerDocument._listFeatures(result, visited, query);\n      }\n      if (feature.kinds.has('document')) {\n        (feature as Document)._listFeatures(result, visited, query);\n      }\n      if (feature.kinds.has('import') && query.imported) {\n        const imprt = feature as Import;\n        const isPackageInternal =\n            imprt.document && !Analysis.isExternal(imprt.url);\n        const externalityOk = query.externalPackages || isPackageInternal;\n        const lazinessOk = !query.noLazyImports || !imprt.lazy;\n        if (imprt.document !== undefined && externalityOk && lazinessOk) {\n          imprt.document._listFeatures(result, visited, query);\n        }\n      }\n    }\n  }\n\n  private _filterOutExternal(features: Set<Feature>): Set<Feature> {\n    const result = new Set();\n    for (const feature of features) {\n      if (feature.sourceRange &&\n          Analysis.isExternal(feature.sourceRange.file)) {\n        continue;\n      }\n      result.add(feature);\n    }\n    return result;\n  }\n\n  /**\n   * Get warnings for the document and all matched features.\n   */\n  getWarnings(query: Query = {}): Warning[] {\n    const warnings: Set<Warning> = new Set(this.warnings);\n    for (const feature of this.getFeatures(query)) {\n      for (const warning of feature.warnings) {\n        warnings.add(warning);\n      }\n    }\n    return Array.from(warnings);\n  }\n\n  toString(): string {\n    return this._toString(new Set()).join('\\n');\n  }\n\n  private _toString(documentsWalked: Set<Document>) {\n    let result =\n        [`<Document type=${this.parsedDocument.type} url=${this.url}>\\n`];\n    if (documentsWalked.has(this)) {\n      return result;\n    }\n    documentsWalked.add(this);\n\n    for (const localFeature of this._localFeatures) {\n      if (localFeature instanceof Document) {\n        result = result.concat(\n            localFeature._toString(documentsWalked).map((line) => `  ${line}`));\n      } else {\n        let subResult = localFeature.toString();\n        if (subResult === '[object Object]') {\n          subResult = `<${localFeature.constructor.name} kinds=\"${\n              Array.from(localFeature.kinds).join(', ')}\" ids=\"${\n              Array.from(localFeature.identifiers).join(',')}\">}`;\n        }\n        result.push(`  ${subResult}`);\n      }\n    }\n\n    return result;\n  }\n\n  stringify(): string {\n    const inlineDocuments =\n        (Array.from(this._localFeatures)\n             .filter((f) => f instanceof Document && f.isInline) as Document[])\n            .map((d) => d.parsedDocument);\n    return this.parsedDocument.stringify({inlineDocuments: inlineDocuments});\n  }\n\n  private _indexFeature(feature: Feature) {\n    if (!this._featuresByKind || !this._featuresByKindAndId) {\n      return;\n    }\n    for (const kind of feature.kinds) {\n      const kindSet = this._featuresByKind.get(kind) || new Set<Feature>();\n      kindSet.add(feature);\n      this._featuresByKind.set(kind, kindSet);\n      for (const id of feature.identifiers) {\n        const identifiersMap = this._featuresByKindAndId.get(kind) ||\n            new Map<string, Set<Feature>>();\n        this._featuresByKindAndId.set(kind, identifiersMap);\n        const idSet = identifiersMap.get(id) || new Set<Feature>();\n        identifiersMap.set(id, idSet);\n        idSet.add(feature);\n      }\n    }\n  }\n\n  private _featuresByKind: Map<string, Set<Feature>>|null = null;\n  private _featuresByKindAndId: Map<string, Map<string, Set<Feature>>>|null =\n      null;\n  private _buildIndexes() {\n    if (this._featuresByKind) {\n      throw new Error(\n          'Tried to build indexes multiple times. This should never happen.');\n    }\n    if (!this._doneResolving) {\n      throw new Error(\n          `Tried to build indexes before finished resolving. ` +\n          `Need to wait until afterwards or the indexes would be incomplete.`);\n    }\n    this._featuresByKind = new Map<string, Set<Feature>>();\n    this._featuresByKindAndId = new Map<string, Map<string, Set<Feature>>>();\n    for (const feature of this.getFeatures(\n             {imported: true, externalPackages: true})) {\n      this._indexFeature(feature);\n    }\n  }\n}\n"]}