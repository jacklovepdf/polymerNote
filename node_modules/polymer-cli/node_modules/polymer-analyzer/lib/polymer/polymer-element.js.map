{"version":3,"sources":["../src/polymer/polymer-element.ts"],"names":[],"mappings":"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","file":"polymer-element.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2015 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as babel from '@babel/types';\nimport * as dom5 from 'dom5/lib/index-next';\nimport * as parse5 from 'parse5';\n\nimport {getOrInferPrivacy} from '../javascript/esutil';\nimport * as jsdoc from '../javascript/jsdoc';\nimport {Annotation as JsDocAnnotation, Annotation} from '../javascript/jsdoc';\nimport {ImmutableArray} from '../model/immutable';\nimport {AstNodeWithLanguage, Class, Document, Element, ElementBase, LiteralValue, Privacy, Property, ScannedAttribute, ScannedElement, ScannedElementBase, ScannedEvent, ScannedMethod, ScannedProperty, SourceRange, Warning} from '../model/model';\nimport {ScannedReference} from '../model/reference';\n\nimport {Behavior} from './behavior';\nimport {DomModule} from './dom-module-scanner';\nimport {JavascriptDatabindingExpression} from './expression-scanner';\n\nexport interface BasePolymerProperty {\n  published?: boolean;\n  notify?: boolean;\n  observer?: string;\n  observerNode?: babel.Expression|babel.Pattern;\n  observerExpression?: JavascriptDatabindingExpression;\n  reflectToAttribute?: boolean;\n  computedExpression?: JavascriptDatabindingExpression;\n\n  /**\n   * True if the property is part of Polymer's element configuration syntax.\n   *\n   * e.g. 'properties', 'is', 'extends', etc\n   */\n  isConfiguration?: boolean;\n\n  /**\n   * Constructor used when deserializing this property from an attribute.\n   */\n  attributeType?: string;\n}\n\nexport interface ScannedPolymerProperty extends ScannedProperty,\n                                                BasePolymerProperty {}\n\nexport interface PolymerProperty extends Property, BasePolymerProperty {}\n\nexport function mergePropertyDeclarations(\n    propA: Readonly<ScannedPolymerProperty>,\n    propB: Readonly<ScannedPolymerProperty>): ScannedPolymerProperty {\n  if (propA.name !== propB.name) {\n    throw new Error(\n        `Tried to merge properties with different names: ` +\n        `'${propA.name}' and ' ${propB.name}'`);\n  }\n  const name = propA.name;\n  const description =\n      jsdoc.pickBestDescription(propA.description, propB.description);\n  const jsdocAnn: Annotation = {description: description || '', tags: []};\n  if (propA.jsdoc) {\n    jsdocAnn.tags.push(...propA.jsdoc.tags);\n  }\n  if (propB.jsdoc) {\n    jsdocAnn.tags.push(...propB.jsdoc.tags);\n  }\n  const privacy = getOrInferPrivacy(propA.name, jsdocAnn);\n  const warnings = [...propA.warnings, ...propB.warnings];\n  // If either are marked as readOnly, both are.\n  const readOnly = propA.readOnly || propB.readOnly;\n\n  // Handle all regular property metadata.\n  const scannedRegularProperty: ScannedProperty = {\n    // calculated above with care\n    name,\n    privacy,\n    description,\n    warnings,\n    readOnly,\n    jsdoc: jsdocAnn,\n\n    // prefer A, but take B if there's no A.\n    sourceRange: propA.sourceRange || propB.sourceRange,\n    astNode: propA.astNode || propB.astNode,\n    changeEvent: propA.changeEvent || propB.changeEvent,\n    default: propA.default || propB.default,\n    type: propA.type || propB.type,\n  };\n  const scannedPolymerProperty: ScannedPolymerProperty = scannedRegularProperty;\n\n  // For the scannedPolymerProperty keys, set them if they're there\n  const keys = [\n    'published' as 'published',\n    'notify' as 'notify',\n    'observer' as 'observer',\n    'observerNode' as 'observerNode',\n    'observerExpression' as 'observerExpression',\n    'reflectToAttribute' as 'reflectToAttribute',\n    'computedExpression' as 'computedExpression'\n  ];\n  for (const key of keys) {\n    if (propA[key] || propB[key]) {\n      scannedPolymerProperty[key] = propA[key] || propB[key];\n    }\n  }\n  if (propA.published || propB.published) {\n    scannedPolymerProperty.published = propA.published || propB.published;\n  }\n  return scannedPolymerProperty;\n}\n\nexport class LocalId {\n  name: string;\n  range: SourceRange;\n  nodeName: string;\n\n  constructor(name: string, range: SourceRange, nodeName: string) {\n    this.name = name;\n    this.range = range;\n    this.nodeName = nodeName;\n  }\n}\n\nexport interface Observer {\n  javascriptNode: babel.Expression|babel.SpreadElement;\n  expression: LiteralValue;\n  parsedExpression: JavascriptDatabindingExpression|undefined;\n}\n\nexport interface Options {\n  tagName: string|undefined;\n  className: string|undefined;\n  superClass: ScannedReference<'class'>|undefined;\n  mixins: ScannedReference<'element-mixin'>[];\n  extends: string|undefined;\n  jsdoc: JsDocAnnotation;\n  description: string|undefined;\n  properties: ScannedProperty[];\n  methods: Map<string, ScannedMethod>;\n  staticMethods: Map<string, ScannedMethod>;\n  attributes: Map<string, ScannedAttribute>;\n  observers: Observer[];\n  listeners: {event: string, handler: string}[];\n  behaviors: ScannedReference<'behavior'>[];\n\n  events: Map<string, ScannedEvent>;\n\n  abstract: boolean;\n  privacy: Privacy;\n  astNode: AstNodeWithLanguage;\n  statementAst: babel.Statement|undefined;\n  sourceRange: SourceRange|undefined;\n}\n\nexport interface ScannedPolymerExtension extends ScannedElementBase {\n  properties: Map<string, ScannedPolymerProperty>;\n  methods: Map<string, ScannedMethod>;\n  observers: Observer[];\n  listeners: {event: string, handler: string}[];\n  behaviorAssignments: ScannedReference<'behavior'>[];\n  // TODO(justinfagnani): Not Polymer-specific, and hopefully not necessary\n  pseudo: boolean;\n\n  addProperty(prop: ScannedPolymerProperty): void;\n}\n\nexport function addProperty(\n    target: ScannedPolymerExtension, prop: ScannedPolymerProperty) {\n  const existingProp = target.properties.get(prop.name);\n  if (existingProp) {\n    prop = mergePropertyDeclarations(existingProp, prop);\n  }\n  target.properties.set(prop.name, prop);\n  const attributeName = propertyToAttributeName(prop.name);\n  // Don't produce attributes or events for nonpublic properties, properties\n  // that aren't in Polymer's `properties` block (i.e. not published),\n  // or properties whose names can't be converted into attribute names.\n  if ((prop.privacy && prop.privacy !== 'public') || !attributeName ||\n      !prop.published) {\n    return;\n  }\n  target.attributes.set(attributeName, {\n    name: attributeName,\n    sourceRange: prop.sourceRange,\n    description: prop.description,\n    type: prop.type,\n    changeEvent: prop.notify ? `${attributeName}-changed` : undefined\n  });\n  if (prop.notify) {\n    const name = `${attributeName}-changed`;\n    target.events.set(name, {\n      name,\n      description: `Fired when the \\`${prop.name}\\` property changes.`,\n      sourceRange: prop.sourceRange,\n      astNode: prop.astNode,\n      warnings: [],\n      params: []\n    });\n  }\n}\n\nexport function addMethod(\n    target: ScannedPolymerExtension, method: ScannedMethod) {\n  target.methods.set(method.name, method);\n}\n\nexport function addStaticMethod(\n    target: ScannedPolymerExtension, method: ScannedMethod) {\n  target.staticMethods.set(method.name, method);\n}\n\n/**\n * The metadata for a single polymer element\n */\nexport class ScannedPolymerElement extends ScannedElement implements\n    ScannedPolymerExtension {\n  properties = new Map<string, ScannedPolymerProperty>();\n  methods = new Map<string, ScannedMethod>();\n  staticMethods = new Map<string, ScannedMethod>();\n  observers: Observer[] = [];\n  listeners: {event: string, handler: string}[] = [];\n  behaviorAssignments: ScannedReference<'behavior'>[] = [];\n  // Indicates if an element is a pseudo element\n  pseudo: boolean = false;\n  abstract: boolean = false;\n\n  constructor(options: Options) {\n    super();\n    this.tagName = options.tagName;\n    this.className = options.className;\n    this.superClass = options.superClass;\n    this.mixins = options.mixins;\n    this.extends = options.extends;\n    this.jsdoc = options.jsdoc;\n    this.description = options.description || '';\n    this.attributes = options.attributes;\n    this.observers = options.observers;\n    this.listeners = options.listeners;\n    this.behaviorAssignments = options.behaviors;\n    this.events = options.events;\n    this.abstract = options.abstract;\n    this.privacy = options.privacy;\n    this.astNode = options.astNode;\n    this.statementAst = options.statementAst;\n    this.sourceRange = options.sourceRange;\n\n    if (options.properties) {\n      options.properties.forEach((p) => this.addProperty(p));\n    }\n    if (options.methods) {\n      options.methods.forEach((m) => this.addMethod(m));\n    }\n    if (options.staticMethods) {\n      options.staticMethods.forEach((m) => this.addStaticMethod(m));\n    }\n    const summaryTag = jsdoc.getTag(this.jsdoc, 'summary');\n    this.summary =\n        (summaryTag !== undefined && summaryTag.description != null) ?\n        summaryTag.description :\n        '';\n  }\n\n  addProperty(prop: ScannedPolymerProperty) {\n    addProperty(this, prop);\n  }\n\n  addMethod(method: ScannedMethod) {\n    addMethod(this, method);\n  }\n\n  addStaticMethod(method: ScannedMethod) {\n    addStaticMethod(this, method);\n  }\n\n  resolve(document: Document): PolymerElement {\n    return new PolymerElement(this, document);\n  }\n}\n\nexport interface PolymerExtension extends ElementBase {\n  properties: Map<string, PolymerProperty>;\n\n  observers: ImmutableArray < {\n    javascriptNode: babel.Expression|babel.SpreadElement,\n        expression: LiteralValue,\n        parsedExpression: JavascriptDatabindingExpression|undefined;\n  }\n  > ;\n  listeners: ImmutableArray<{event: string, handler: string}>;\n  behaviorAssignments: ImmutableArray<ScannedReference<'behavior'>>;\n  localIds: ImmutableArray<LocalId>;\n\n  // tslint:disable-next-line: no-any TODO: define type for poperty metadata.\n  emitPropertyMetadata(property: PolymerProperty): any;\n}\n\ndeclare module '../model/queryable' {\n  interface FeatureKindMap {\n    'polymer-element': PolymerElement;\n    'pseudo-element': Element;\n  }\n}\n\nexport class PolymerElement extends Element implements PolymerExtension {\n  // This property is assigned in the super class. We just refine its type here.\n  readonly properties!: Map<string, PolymerProperty>;\n  readonly observers: ImmutableArray<Observer> = [];\n  readonly listeners: ImmutableArray<{event: string, handler: string}> = [];\n  readonly behaviorAssignments: ImmutableArray<ScannedReference<'behavior'>> =\n      [];\n  readonly domModule?: dom5.Node;\n  readonly localIds: ImmutableArray<LocalId> = [];\n\n  constructor(scannedElement: ScannedPolymerElement, document: Document) {\n    super(scannedElement, document);\n\n\n    this.kinds.add('polymer-element');\n\n    this.observers = Array.from(scannedElement.observers);\n    this.listeners = Array.from(scannedElement.listeners);\n    this.behaviorAssignments = Array.from(scannedElement.behaviorAssignments);\n\n    const domModules = scannedElement.tagName == null ?\n        new Set<DomModule>() :\n        document.getFeatures({\n          kind: 'dom-module',\n          id: scannedElement.tagName,\n          imported: true,\n          externalPackages: true\n        });\n    let domModule = undefined;\n    if (domModules.size === 1) {\n      // TODO(rictic): warn if this isn't true.\n      domModule = domModules.values().next().value;\n    }\n\n    if (domModule) {\n      this.domModule = domModule.node;\n      this.slots = this.slots.concat(domModule.slots);\n      this.localIds = domModule.localIds.slice();\n      // If there's a domModule and it's got a comment, that comment documents\n      // this element too. Extract its description and @demo annotations.\n      if (domModule.comment) {\n        const domModuleJsdoc = jsdoc.parseJsdoc(domModule.comment);\n        this.demos = [...jsdoc.extractDemos(domModuleJsdoc), ...this.demos];\n        if (domModuleJsdoc.description) {\n          this.description =\n              (domModuleJsdoc.description + '\\n\\n' + this.description).trim();\n        }\n      }\n      const template =\n          dom5.query(domModule.node, dom5.predicates.hasTagName('template'));\n      if (template) {\n        this.template = {\n          kind: 'polymer-databinding',\n          contents: parse5.treeAdapters.default.getTemplateContent(template)\n        };\n      }\n    }\n\n    if (scannedElement.pseudo) {\n      this.kinds.add('pseudo-element');\n    }\n  }\n\n  emitPropertyMetadata(property: PolymerProperty) {\n    return {\n      polymer: {\n        notify: property.notify,\n        observer: property.observer,\n        readOnly: property.readOnly,\n        attributeType: property.attributeType,\n      }\n    };\n  }\n\n  protected _getSuperclassAndMixins(\n      document: Document, init: ScannedPolymerElement): Class[] {\n    const prototypeChain = super._getSuperclassAndMixins(document, init);\n\n    const {warnings, behaviors} =\n        getBehaviors(init.behaviorAssignments, document);\n\n    this.warnings.push(...warnings);\n    prototypeChain.push(...behaviors);\n    return prototypeChain;\n  }\n}\n\n/**\n * Implements Polymer core's translation of property names to attribute names.\n *\n * Returns null if the property name cannot be so converted.\n */\nfunction propertyToAttributeName(propertyName: string): string|null {\n  // Polymer core will not map a property name that starts with an uppercase\n  // character onto an attribute.\n  if (propertyName[0].toUpperCase() === propertyName[0]) {\n    return null;\n  }\n  return propertyName.replace(\n      /([A-Z])/g, (_: string, c1: string) => `-${c1.toLowerCase()}`);\n}\n\nexport function getBehaviors(\n    behaviorReferences: Iterable<ScannedReference<'behavior'>>,\n    document: Document) {\n  const warnings: Warning[] = [];\n  const behaviors: Behavior[] = [];\n  for (const scannedReference of behaviorReferences) {\n    const resolvedReference = scannedReference.resolve(document);\n    if (resolvedReference.warnings.length > 0) {\n      warnings.push(...resolvedReference.warnings);\n    }\n    if (resolvedReference.feature) {\n      behaviors.push(resolvedReference.feature);\n    }\n  }\n  return {warnings, behaviors};\n}\n"]}