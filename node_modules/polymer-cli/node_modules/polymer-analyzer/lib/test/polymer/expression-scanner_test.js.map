{"version":3,"sources":["../src/test/polymer/expression-scanner_test.ts"],"names":[],"mappings":"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","file":"expression-scanner_test.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2017 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as babel from '@babel/types';\nimport {assert} from 'chai';\n\nimport {HtmlParser} from '../../html/html-parser';\nimport {JavaScriptParser} from '../../javascript/javascript-parser';\nimport {AttributeDatabindingExpression, parseExpressionInJsStringLiteral, scanDocumentForExpressions, TextNodeDatabindingExpression} from '../../polymer/expression-scanner';\nimport {PackageUrlResolver} from '../../url-loader/package-url-resolver';\nimport {CodeUnderliner, resolvedUrl} from '../test-utils';\n\nsuite('ExpressionScanner', () => {\n  suite('scanning html for expressions', () => {\n    test('finds whole-attribute expressions', async () => {\n      const contents = `\n        <dom-module id=\"foo-elem\">\n          <template>\n            <div id=\"{{foo}}\"></div>\n            <input value=\"{{val::changed}}\">\n            <template is=\"dom-if\">\n              <div id=\"[[bar]]\"></div>\n            </template>\n            <div id=\"{{bada(wing, daba.boom, 10, -20)}}\"></div>\n          </template>\n          <script>\n            Polymer({\n              is: 'foo-elem',\n            });\n          </script>\n        </dom-module>\n\n        <div id=\"{{nope}}\"></div>\n        <template>\n          <div id=\"{{notHereEither}}\"></div>\n        </template>\n\n        <template is=\"dom-bind\">\n          <div id=\"{{baz}}\"></div>\n          <div id=\"{{camel.casePath}}\"></div>\n          <div id=\"{{kebab.case-path}}\"></div>\n        </template>\n      `;\n      const underliner =\n          CodeUnderliner.withMapping(resolvedUrl`test.html`, contents);\n      const document = new HtmlParser().parse(\n          contents, resolvedUrl`test.html`, new PackageUrlResolver());\n\n      const results = await scanDocumentForExpressions(document);\n      const generalExpressions = results.expressions;\n\n      assert.deepEqual(results.warnings, []);\n      assert.deepEqual(generalExpressions.map((e) => e.databindingInto), [\n        'attribute',\n        'attribute',\n        'attribute',\n        'attribute',\n        'attribute',\n        'attribute',\n        'attribute'\n      ]);\n      const expressions =\n          generalExpressions as AttributeDatabindingExpression[];\n      assert.deepEqual(\n          await underliner.underline(expressions.map((e) => e.sourceRange)), [\n            `\n            <div id=\"{{foo}}\"></div>\n                       ~~~`,\n            `\n            <input value=\"{{val::changed}}\">\n                            ~~~~~~~~~~~~`,\n            `\n            <div id=\"{{bada(wing, daba.boom, 10, -20)}}\"></div>\n                       ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~`,\n            `\n              <div id=\"[[bar]]\"></div>\n                         ~~~`,\n            `\n          <div id=\"{{baz}}\"></div>\n                     ~~~`,\n            `\n          <div id=\"{{camel.casePath}}\"></div>\n                     ~~~~~~~~~~~~~~`,\n            `\n          <div id=\"{{kebab.case-path}}\"></div>\n                     ~~~~~~~~~~~~~~~`,\n          ]);\n      assert.deepEqual(\n          expressions.map((e) => e.direction),\n          ['{', '{', '{', '[', '{', '{', '{']);\n      assert.deepEqual(expressions.map((e) => e.expressionText), [\n        'foo',\n        'val',\n        'bada(wing, daba.boom, 10, -20)',\n        'bar',\n        'baz',\n        'camel.casePath',\n        'kebab.case-path'\n      ]);\n      assert.deepEqual(expressions.map((e) => e.eventName), [\n        undefined,\n        'changed',\n        undefined,\n        undefined,\n        undefined,\n        undefined,\n        undefined\n      ]);\n      assert.deepEqual(\n          expressions.map((e) => e.attribute && e.attribute.name),\n          ['id', 'value', 'id', 'id', 'id', 'id', 'id']);\n      assert.deepEqual(\n          expressions.map((e) => e.properties.map((p) => p.name)), [\n            ['foo'],\n            ['val'],\n            ['bada', 'wing', 'daba'],\n            ['bar'],\n            ['baz'],\n            ['camel'],\n            ['kebab']\n          ]);\n      assert.deepEqual(\n          expressions.map((e) => e.warnings), [[], [], [], [], [], [], []]);\n      assert.deepEqual(\n          expressions.map((e) => e.isCompleteBinding),\n          [true, true, true, true, true, true, true]);\n    });\n\n    test('finds interpolated attribute expressions', async () => {\n      const contents = `\n        <template is=\"dom-bind\">\n          <div id=\" {{foo}}\"></div>\n          <div id=\"bar {{val}} baz\">\n          <div id=\" [[x]]{{y}}\"></div>\n        </template>\n\n        <div id=\" {{nope}}\"></div>\n        <template>\n          <div id=\"{{notHereEither}}\"></div>\n        </template>\n\n      `;\n      const underliner =\n          CodeUnderliner.withMapping(resolvedUrl`test.html`, contents);\n      const document = new HtmlParser().parse(\n          contents, resolvedUrl`test.html`, new PackageUrlResolver());\n\n      const results = await scanDocumentForExpressions(document);\n      const generalExpressions = results.expressions;\n\n      assert.deepEqual(results.warnings, []);\n      assert.deepEqual(\n          await underliner.underline(\n              generalExpressions.map((e) => e.sourceRange)),\n          [\n            `\n          <div id=\" {{foo}}\"></div>\n                      ~~~`,\n            `\n          <div id=\"bar {{val}} baz\">\n                         ~~~`,\n            `\n          <div id=\" [[x]]{{y}}\"></div>\n                      ~`,\n            `\n          <div id=\" [[x]]{{y}}\"></div>\n                           ~`\n          ]);\n      const expressions =\n          generalExpressions as AttributeDatabindingExpression[];\n      assert.deepEqual(\n          expressions.map((e) => e.isCompleteBinding),\n          [false, false, false, false]);\n      assert.deepEqual(\n          expressions.map((e) => e.direction), ['{', '{', '[', '{']);\n      assert.deepEqual(\n          expressions.map((e) => e.expressionText), ['foo', 'val', 'x', 'y']);\n      assert.deepEqual(\n          expressions.map((e) => e.properties.map((p) => p.name)),\n          [['foo'], ['val'], ['x'], ['y']]);\n      assert.deepEqual(expressions.map((e) => e.warnings), [[], [], [], []]);\n      assert.deepEqual(\n          expressions.map((e) => e.eventName),\n          [undefined, undefined, undefined, undefined]);\n      assert.deepEqual(\n          expressions.map((e) => e.attribute && e.attribute.name),\n          ['id', 'id', 'id', 'id']);\n      assert.deepEqual(\n          expressions.map((e) => e.databindingInto),\n          ['attribute', 'attribute', 'attribute', 'attribute']);\n    });\n\n    test('finds expressions in text nodes', async () => {\n      const contents = `\n        <template is=\"dom-bind\">\n          <div>{{foo}}</div>\n          <div>\n            {{bar}} + {{baz}}[[zod]]\n            {{\n              multiline(\n                expressions\n              )\n            }}\n          </div>\n        </template>\n\n        {{nope}}\n        <template>\n          <div id=\"{{notHereEither}}\"></div>\n        </template>\n      `;\n\n      const underliner =\n          CodeUnderliner.withMapping(resolvedUrl`test.html`, contents);\n      const document = new HtmlParser().parse(\n          contents, resolvedUrl`test.html`, new PackageUrlResolver());\n\n      const results = await scanDocumentForExpressions(document);\n      const generalExpressions = results.expressions;\n\n      assert.deepEqual(results.warnings, []);\n      assert.deepEqual(\n          generalExpressions.map((e) => e.databindingInto),\n          ['text-node', 'text-node', 'text-node', 'text-node', 'text-node']);\n      const expressions = generalExpressions as TextNodeDatabindingExpression[];\n      assert.deepEqual(\n          await underliner.underline(expressions.map((e) => e.sourceRange)), [\n            `\n          <div>{{foo}}</div>\n                 ~~~`,\n            `\n            {{bar}} + {{baz}}[[zod]]\n              ~~~`,\n            `\n            {{bar}} + {{baz}}[[zod]]\n                        ~~~`,\n            `\n            {{bar}} + {{baz}}[[zod]]\n                               ~~~`,\n            `\n            {{\n              ~\n              multiline(\n~~~~~~~~~~~~~~~~~~~~~~~~\n                expressions\n~~~~~~~~~~~~~~~~~~~~~~~~~~~\n              )\n~~~~~~~~~~~~~~~\n            }}\n~~~~~~~~~~~~`\n          ]);\n      assert.deepEqual(\n          expressions.map((e) => e.direction), ['{', '{', '{', '[', '{']);\n      assert.deepEqual(expressions.map((e) => e.expressionText), [\n        'foo',\n        'bar',\n        'baz',\n        'zod',\n        `\n              multiline(\n                expressions\n              )\n            `\n      ]);\n      assert.deepEqual(\n          expressions.map((e) => e.properties.map((p) => p.name)),\n          [['foo'], ['bar'], ['baz'], ['zod'], ['multiline', 'expressions']]);\n      assert.deepEqual(\n          expressions.map((e) => e.warnings), [[], [], [], [], []]);\n    });\n\n    test('gives accurate locations for parse errors', async () => {\n      const contents = `\n        <template is=\"dom-bind\">\n          <div id=\"{{foo(}}\"></div>\n          <div id='[[\n            foo bar\n          ]]'></div>\n          {{]}}\n\n          <!-- ignores expressions that are invalid JS -->\n          <div id=\"{{foo(bar.*)}}\"></div>\n          <div id=\"{{foo(bar.0)}}\"></div>\n\n          <!-- finds warnings in valid JS but invalid Polymer expressions -->\n          <div id=\"{{-foo}}\"></div>\n          {{foo(!bar, () => baz)}}\n        </template>\n      `;\n\n      const underliner =\n          CodeUnderliner.withMapping(resolvedUrl`test.html`, contents);\n      const document = new HtmlParser().parse(\n          contents, resolvedUrl`test.html`, new PackageUrlResolver());\n\n      const results = await scanDocumentForExpressions(document);\n      assert.deepEqual(\n          await underliner.underline(\n              results.warnings.map((w) => w.sourceRange)),\n          [\n            `\n          <div id=\"{{foo(}}\"></div>\n                         ~`,\n            `\n            foo bar\n                ~`,\n            `\n          {{]}}\n            ~`,\n            `\n          <div id=\"{{-foo}}\"></div>\n                     ~~~~`,\n            `\n          {{foo(!bar, () => baz)}}\n                ~~~~`,\n            `\n          {{foo(!bar, () => baz)}}\n                      ~~~~~~~~~`\n          ]);\n    });\n  });\n\n  suite('parsing expressions from javascript string literals', () => {\n    test('it succeeds and fails properly', async () => {\n      const contents = `\n        const observers = [\n          'foo(bar, baz)',\n          'foo(bar baz)',\n          'foo(bar.*)',\n          10,\n          observerAssignedElsewhere,\n        ];\n      `;\n      const underliner =\n          CodeUnderliner.withMapping(resolvedUrl`test.html`, contents);\n      const javascriptDocument = new JavaScriptParser().parse(\n          contents, resolvedUrl`test.html`, new PackageUrlResolver());\n      const literals: babel.Literal[] =\n          // tslint:disable-next-line: no-any\n          (javascriptDocument.ast.program as any)\n              .body[0]['declarations'][0]['init']['elements'];\n\n      const parsedLiterals = literals.map(\n          (l) =>\n              parseExpressionInJsStringLiteral(javascriptDocument, l, 'full'));\n      const warnings = parsedLiterals.map((pl) => pl.warnings)\n                           .reduce((p, n) => p.concat(n), []);\n      const expressionRanges = parsedLiterals.map(\n          (pl) => pl.databinding && pl.databinding.sourceRange);\n      assert.deepEqual(await underliner.underline(expressionRanges), [\n        `\n          'foo(bar, baz)',\n           ~~~~~~~~~~~~~`,\n        `No source range given.`,\n        `\n          'foo(bar.*)',\n           ~~~~~~~~~~`,\n        `No source range given.`,\n        `No source range given.`,\n      ]);\n      assert.deepEqual(await underliner.underline(warnings), [\n        `\n          'foo(bar baz)',\n                   ~`,\n        `\n          10,\n          ~~`,\n        `\n          observerAssignedElsewhere,\n          ~~~~~~~~~~~~~~~~~~~~~~~~~`,\n      ]);\n    });\n  });\n});\n"]}